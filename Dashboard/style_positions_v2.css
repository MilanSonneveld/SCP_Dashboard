:root {
  --bg: #f6f7fb;
  --panel: #ffffff;
  --text: #121826;
  --muted: #5f6b7a;
  --border: rgba(18, 24, 38, 0.12);

  --link: rgba(18, 24, 38, 0.35);
  --linkStrong: rgba(18, 24, 38, 0.8);

  --accent: #e11d48;   /* selection */
  --accent2: #f59e0b;  /* downstream */
}

* { box-sizing: border-box; }

html, body {
  height: 100%;
  margin: 0;
}

body {
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background: var(--bg);
  color: var(--text);

  display: flex;
  flex-direction: column;
  overflow: hidden; /* no page scroll */
}

header {
  padding: 16px 18px;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(#ffffff, #fafbff);
}

h1 { margin: 0 0 8px 0; font-size: 18px; }
.hint { color: var(--muted); font-size: 13px; line-height: 1.4; }

/* ====== DASHBOARD LAYOUT ======
   2 columns (graph + side panel)
   2 rows (main content + bottom formula)
*/
main {
  flex: 1 1 auto;
  min-height: 0;
  display: grid;

  grid-template-columns: 1fr 360px;
  grid-template-rows: 1fr 320px; /* bigger bottom panel */
  gap: 12px;
  padding: 12px;
}

/* grid placement */
#left   { grid-column: 1; grid-row: 1; min-height: 0; }
#right  { grid-column: 2; grid-row: 1; min-height: 0; overflow: auto; }
/* Left (graph) panel */
#left {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 16px;
  overflow: hidden;
  position: relative;
}

#graph { width: 100%; height: 100%; display: block; }

/* Right side panel */
#right {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 14px;
  overflow: auto;
}

#right h2 { margin: 0 0 10px 0; font-size: 16px; }

#panel {
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 12px;
  background: #fbfcff;
}

.muted { color: var(--muted); }

.buttons { margin-top: 12px; display: flex; gap: 8px; }

button {
  border: 1px solid var(--border);
  background: #f3f5fb;
  color: var(--text);
  padding: 10px 12px;
  border-radius: 12px;
  cursor: pointer;
}
button:hover { background: #e9eefc; }

/* ---- Graph ---- */
.link {
  stroke: var(--link);
  stroke-width: 2.2;
  fill: none;
  cursor: pointer;
  pointer-events: stroke;
}

.link.selected { stroke: var(--accent); stroke-width: 3.4; }
.link.downstream { stroke: var(--accent2); stroke-width: 3.0; }
.link.dimmed { opacity: 0.55; }

.node circle {
  stroke: rgba(18,24,38,0.35);
  stroke-width: 1.2;
  cursor: pointer;
  transition: r 200ms ease, opacity 160ms ease;
}

.node text {
  fill: rgba(18,24,38,0.90);
  font-size: 12px;
  pointer-events: none;
}

.node.selected circle { stroke: var(--accent); stroke-width: 2.6; }
.node.downstream circle { stroke: var(--accent2); stroke-width: 2.2; }
.node.dimmed { opacity: 0.7; }

/* Edge +/- labels */
.link-label {
  font-size: 12px;
  font-weight: 700;
  fill: rgba(18,24,38,0.75);
  pointer-events: none;
  paint-order: stroke;
  stroke: rgba(255,255,255,0.9);
  stroke-width: 3px;
}

/* Formula formatting */
.kv { margin: 0 0 10px 0; }
.k { color: var(--muted); font-size: 12px; margin-bottom: 4px; }
.v { font-size: 13px; line-height: 1.35; white-space: pre-wrap; }

code {
  display: block;
  padding: 10px;
  border-radius: 10px;
  background: #f2f4fb;
  border: 1px solid var(--border);
  color: rgba(18,24,38,0.95);
  overflow-x: auto;
}

/* Sliders */
.sliders {
  margin-top: 10px;
  display: grid;
  gap: 10px;
}

.slider {
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  background: #fbfcff;
}

.slider .top {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  align-items: baseline;
}

.slider .name { font-size: 13px; font-weight: 600; }
.slider .val { font-size: 12px; color: var(--muted); }

.slider input[type="range"] { width: 100%; margin-top: 8px; }

/* ====== Bottom Formula Panel (not fixed; part of grid) ====== */
.drawer {
  position: relative;
  height: auto;

  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 16px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.10);
  overflow: hidden;
}

.drawer-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 12px;
  border-bottom: 1px solid var(--border);
  background: #fbfcff;
}

.drawer-title { font-weight: 700; }

.drawer-body {
  display: grid;
  grid-template-columns: 1.35fr 0.95fr; /* left bigger than right */
  gap: 12px;
  padding: 12px;
  height: calc(100% - 48px);
}

.drawer-col { overflow: auto; }

.drawer-formula {
  margin: 0;
  padding: 10px;
  border-radius: 12px;
  background: #f2f4fb;
  border: 1px solid var(--border);
  height: auto;
  max-height: 140px; /* keeps formula readable; adjust if you want */
  overflow: auto;
  white-space: pre-wrap;
}

.drawer-text { font-size: 13px; line-height: 1.35; }

.drawer-sources { margin: 6px 0 0 18px; }
.drawer-sources li { color: var(--muted); font-size: 12px; margin-bottom: 4px; }

.vars {
  display: grid;
  gap: 10px;
}

.var {
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  background: #fbfcff;
}

.var-top {
  display: flex;
  justify-content: space-between;
  gap: 10px;
  align-items: baseline;
}

.var-name {
  font-size: 13px;
  font-weight: 700;
}

.var-default {
  font-size: 12px;
  color: var(--muted);
  white-space: nowrap;
}

.var-desc {
  margin-top: 6px;
  font-size: 12px;
  color: var(--muted);
  line-height: 1.35;
}

.vars-empty {
  padding: 10px;
  border: 1px dashed var(--border);
  border-radius: 12px;
  background: #fbfcff;
}




/* --- Added for layout editing / export/import -------------------------------- */
.sidebar-header { padding: 14px 14px 0 14px; }
.sidebar-title { font-weight: 700; font-size: 14px; margin-bottom: 6px; }
.sidebar-subtitle { color: var(--muted); font-size: 12px; line-height: 1.3; margin-bottom: 10px; }

.toolbar { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }

.btn { /* aligns with existing button reset styles */ }
.btn-secondary { border: 1px solid var(--border); background: #fff; }
.btn-small { padding: 6px 10px; font-size: 12px; }

#editLayoutBtn.active { border-color: var(--accent2); box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.15); }

.tiny { font-size: 11px; color: var(--muted); margin-top: 6px; }

/* Node/edge styling hooks used by graph.js */
.node.input { fill: #2563eb; stroke: rgba(18, 24, 38, 0.35); stroke-width: 1.2; }
.node.computed { fill: #111827; stroke: rgba(18, 24, 38, 0.35); stroke-width: 1.2; }
.link { fill: none; stroke: var(--link); stroke-linecap: round; }
.link.selected { stroke: var(--accent); }
.link.downstream { stroke: var(--accent2); }

/* Drawer quantification cards */
.var-card { border: 1px solid var(--border); border-radius: 10px; padding: 12px; background: #fff; margin-bottom: 10px; }
.var-header { display: flex; justify-content: space-between; gap: 10px; align-items: baseline; }
.var-name { font-weight: 700; }
.var-cur { color: var(--muted); font-size: 12px; }
.var-desc, .var-unit { color: var(--muted); font-size: 12px; margin-top: 6px; }
.var-row { margin-top: 10px; }

/* Slider cards in sidebar (if your existing CSS doesn't cover) */
.slider-card { border: 1px solid var(--border); border-radius: 10px; padding: 12px; background: #fff; margin: 10px 14px; }
.slider-title { font-weight: 700; font-size: 13px; margin-bottom: 4px; }
.slider-subtitle { color: var(--muted); font-size: 12px; margin-bottom: 8px; }
.slider-row { display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; }
.slider-value { color: var(--muted); font-size: 12px; min-width: 84px; text-align: right; }

/* Make SVG expand properly */
#graph { width: 100%; height: 100%; display: block; }


/* --- 2x2 dashboard panels --- */
#left { grid-column: 1; grid-row: 1; }
#right { grid-column: 2; grid-row: 1; }

#edgeInfo { grid-column: 1; grid-row: 2; min-height: 0; overflow: auto; }
#edgeParams { grid-column: 2; grid-row: 2; min-height: 0; overflow: auto; }

.panel {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 14px;
  min-height: 0;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(18, 24, 38, 0.06);
  display: flex;
  flex-direction: column;
  padding: 12px;
}
