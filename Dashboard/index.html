<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Causal Diagram Dashboard (D3)</title>
<!-- Use LOCAL D3 to avoid CDN caching + offline surprises -->
  <link rel="stylesheet" href="style_positions_v3_fixed2.css" />
</head>

<body>
  <header>
    <h1>Causal Relationship Dashboard</h1>
    <div class="hint">
      <b>How to edit:</b>
      Click an <b>edge</b> to edit its formula, compute code, explanation and sources (bottom-left) and its parameters (bottom-right).
      Click a <b>node</b> to edit its <b>initial value / baseline</b> (right panel).
    </div>
  </header>

  <main>
    <div id="left">
      <svg id="graph"></svg>
    </div>

    <aside id="right">
      <div class="sidebar-header">
        <div class="sidebar-title">Input variables</div>
        <div class="sidebar-subtitle">
          Use the sliders to adjust assumptions. Changes affect the quantified relationships shown below.
        </div>

        <div class="toolbar">
          <button id="resetBtn" class="btn">Reset</button>

          <button id="editLayoutBtn" class="btn btn-secondary" title="Enable dragging nodes to new positions">
            Edit layout
          </button>

          <button id="exportPositionsBtn" class="btn btn-secondary" title="Download data.json with x/y positions added">
            Export positions
          </button>

          <button id="exportModelBtn" class="btn btn-secondary" title="Download the full model (including formulas and parameter metadata)">
            Export model
          </button>

          <button id="importPositionsBtn" class="btn btn-secondary" title="Load positions from a JSON file">
            Import positions
          </button>
          <input id="importPositionsFile" type="file" accept="application/json" style="display:none" />

          <button id="clearPositionsBtn" class="btn btn-secondary" title="Remove saved positions and go back to auto layout">
            Clear positions
          </button>

          <button id="exportSvgBtn" class="btn btn-secondary" title="Download the current SVG">
            Export SVG
          </button>
        </div>

        <div class="tiny" id="buildTag"></div>
      </div>

      <div id="nodeEditor" class="slider-card" style="display:none">
  <div class="slider-title" id="nodeEditorTitle">Selected node</div>
  <div class="slider-subtitle" id="nodeEditorSubtitle">—</div>

  <div class="drawer-section" style="margin-top:10px">
    <div class="drawer-label" id="nodeBaselineLabel">Initial value</div>
    <div class="tiny" id="nodeBaselineHint">—</div>
    <div class="slider-row" style="margin-top:8px">
      <input id="nodeBaselineRange" type="range" />
      <div class="slider-value" id="nodeBaselineValue">—</div>
    </div>
</div>
</div>

      <div id="sliders"></div>
    </aside>

    <section id="edgeInfo" class="panel">
      <div class="drawer-header">
        <div class="drawer-title" id="drawerTitle">Formula details</div>
        <div class="drawer-actions"></div>
      </div>

      <div class="drawer-left">
        <div class="drawer-section">
          <div class="drawer-label">Selected relationship</div>
          <div id="drawerEdge" class="drawer-value">Click an edge to view its quantification.</div>
        </div>

        <div class="drawer-section">
          <div class="drawer-label">Formula</div>
          <textarea id="drawerFormulaEditor" class="codeedit" rows="3" spellcheck="false" placeholder="Human-readable formula (can include symbols)"></textarea>
        </div>

      <div class="drawer-section">
        <div class="drawer-label">Compute (machine readable)</div>
        <div class="tiny" id="drawerComputeMeta">—</div>
        <pre id="drawerComputeExpr" class="codebox">—</pre>

        <div class="tiny" style="margin-top:8px">Edit expression (local-only; runs as JS):</div>
        <textarea id="computeExprEditor" class="codeedit" rows="3" spellcheck="false"></textarea>
        <div class="row-actions">
          <button id="applyComputeExprBtn" class="btn btn-secondary btn-small">Apply</button>
          <button id="syncUsesBtn" class="btn btn-secondary btn-small" title="Parse variables from the expression and update sliders">Sync variables</button>
        </div>
        <div class="row-actions" style="margin-top:10px">
          <button id="applyEdgeMetaBtn" class="btn btn-secondary btn-small" title="Apply formula/explanation/sources edits to the model">Apply details</button>
        </div>
      </div>

        <div class="drawer-section">
          <div class="drawer-label">Explanation</div>
          <textarea id="drawerExplanationEditor" class="codeedit" rows="3" spellcheck="false" placeholder="Explain the relationship, assumptions, scope, units..."></textarea>
        </div>

        <div class="drawer-section">
  <div class="drawer-label">Sources</div>
  <div class="tiny">One URL (or citation) per line.</div>
  <textarea id="drawerSourcesEditor" class="codeedit" rows="4" spellcheck="false" placeholder="https://...
https://..."></textarea>
</div>
      </div>
    </section>


    <section id="edgeParams" class="panel">
      <div class="drawer-section drawer-right-header" style="margin-top:0">
        <div>
          <div class="drawer-label">Quantification</div>
          <div class="drawer-subtitle">Variables used in the function, with a short description and default (starting) value.</div>
        </div>
        <div class="row-actions">
          <button id="addVarBtn" class="btn btn-secondary btn-small" style="display:none">Add variable</button>
          <button id="resetEdgeVarsBtn" class="btn btn-secondary btn-small" style="display:none">Reset</button>
        </div>
      </div>

      <div id="addVarForm" class="var-form" style="display:none"></div>
      <div id="drawerVars" class="vars"></div>
    </section>

</main>
  <script src="d3.v7.min.js"></script>
<script src="graph_positions_v3_fixed2_baseline_slider_v3json_updated3.js"></script>
</body>
</html>


